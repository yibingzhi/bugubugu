import { defineComponent as S, inject as T, openBlock as _, createElementBlock as f, createElementVNode as e, createCommentVNode as k, Fragment as U, renderList as V, withDirectives as $, toDisplayString as y, unref as u, vShow as B, normalizeClass as b, createVNode as h, withCtx as g, ref as w, pushScopeId as H, popScopeId as q, reactive as M, provide as C, nextTick as j, onMounted as L, renderSlot as z } from "vue";
import { h as D, f as x } from "../../util/datetime.js";
import { u as R } from "../../hooks/use-emoji/index.js";
import { ElAvatar as N, ElScrollbar as A } from "element-plus";
import { UEditor as F, UEmoji as P, UIcon as G, UToast as J } from "undraw-ui";
import { v as K } from "../../util/clean-html.js";
import { _ as E } from "../anchor/index.js";
/*! UndrawUi v1.2.6 */
const O = { class: "chat-content" }, Q = { class: "load-toolbar" }, W = { key: 0 }, X = { key: 1 }, Y = {
  key: 2,
  class: "no-more"
}, Z = { class: "avatar" }, ee = { class: "main-column" }, oe = { class: "title" }, te = { class: "username" }, se = { class: "content" }, re = { class: "text" }, le = { style: { padding: "2px" } }, ne = /* @__PURE__ */ S({
  __name: "content",
  props: {
    data: {},
    load: {}
  },
  setup(n) {
    const c = n, a = T("injectEmoji");
    function p(l, i) {
      if (i == null || i == null)
        return !1;
      let t = Math.floor(new Date(i).getTime() / 1e3);
      if (Math.floor((/* @__PURE__ */ new Date()).getTime() / 1e3) - t < 300)
        return !1;
      if (l == 0 || l == c.data.length - 1)
        return !0;
      let m = c.data[l - 1].createTime;
      return x(i, "y-m-d h:i") != x(m, "y-m-d h:i");
    }
    return (l, i) => (_(), f("div", O, [
      e("div", Q, [
        l.load == 0 ? (_(), f("span", W, "正在加载数据中...")) : k("", !0),
        l.load == 1 ? (_(), f("span", X, "查看更多消息 ...")) : k("", !0),
        l.load == 2 ? (_(), f("span", Y, "没有更多消息了")) : k("", !0)
      ]),
      (_(!0), f(U, null, V(l.data, (t, r) => (_(), f("div", {
        key: t.id,
        class: "message-item"
      }, [
        $(e("div", { class: "datetime" }, y(u(D)(t.createTime)), 513), [
          [B, p(r, t.createTime)]
        ]),
        e("div", {
          class: b(["message-box", { right: t.float }])
        }, [
          e("aside", Z, [
            h(u(N), {
              src: t.user.avatar,
              size: 40
            }, {
              default: g(() => [
                e("span", null, y(t.user.username), 1)
              ]),
              _: 2
            }, 1032, ["src"])
          ]),
          e("main", ee, [
            e("div", oe, [
              e("span", te, y(t.user.username), 1)
            ]),
            e("div", se, [
              e("div", re, [
                $(e("div", le, null, 512), [
                  [u(K), u(R)(u(a).allEmoji, t.content)]
                ])
              ])
            ])
          ])
        ], 2)
      ]))), 128))
    ]));
  }
});
const ae = /* @__PURE__ */ E(ne, [["__scopeId", "data-v-f87d4571"]]), ie = (n) => (H("data-v-2d5dea61"), n = n(), q(), n), ce = { class: "editor" }, de = { class: "footer" }, ue = { class: "left" }, _e = { class: "right" }, fe = /* @__PURE__ */ ie(() => /* @__PURE__ */ e("svg", {
  viewBox: "0 0 1025 1024",
  version: "1.1",
  xmlns: "http://www.w3.org/2000/svg",
  "p-id": "15072"
}, [
  /* @__PURE__ */ e("path", {
    d: "M1008.00076 6.285714q18.857143 13.714286 15.428571 36.571429l-146.285714 877.714286q-2.857143 16.571429-18.285714 25.714286-8 4.571429-17.714286 4.571429-6.285714 0-13.714286-2.857143l-258.857143-105.714286-138.285714 168.571429q-10.285714 13.142857-28 13.142857-7.428571 0-12.571429-2.285714-10.857143-4-17.428571-13.428571t-6.571429-20.857143l0-199.428571 493.714286-605.142857-610.857143 528.571429-225.714286-92.571429q-21.142857-8-22.857143-31.428571-1.142857-22.857143 18.285714-33.714286l950.857143-548.571429q8.571429-5.142857 18.285714-5.142857 11.428571 0 20.571429 6.285714z",
    "p-id": "15073"
  })
], -1)), me = /* @__PURE__ */ S({
  __name: "editor",
  setup(n) {
    const c = w(), a = w(""), p = T("injectEmoji"), l = T("injectSubmit"), i = () => {
      let t = a.value;
      t.trim() ? l(t, () => {
        var r;
        (r = c.value) == null || r.clear();
      }) : J({ type: "error", message: "内容不能为空" });
    };
    return (t, r) => (_(), f("div", ce, [
      h(u(F), {
        ref_key: "editorRef",
        ref: c,
        modelValue: a.value,
        "onUpdate:modelValue": r[1] || (r[1] = (m) => a.value = m),
        placeholder: "请输入内容"
      }, {
        footer: g(() => [
          e("div", de, [
            e("div", ue, [
              h(u(P), {
                emoji: u(p),
                onAddEmoji: r[0] || (r[0] = (m) => {
                  var v;
                  return (v = c.value) == null ? void 0 : v.addText(m);
                })
              }, null, 8, ["emoji"])
            ]),
            e("div", _e, [
              h(u(G), {
                size: "18",
                class: b([{ "submit-btn": a.value.trim() != "" }, "select-none cursor-pointer"]),
                onClick: i
              }, {
                default: g(() => [
                  fe
                ]),
                _: 1
              }, 8, ["class"])
            ])
          ])
        ]),
        _: 1
      }, 8, ["modelValue"])
    ]));
  }
});
const he = /* @__PURE__ */ E(me, [["__scopeId", "data-v-2d5dea61"]]), I = (n) => (H("data-v-ff38d4f4"), n = n(), q(), n), pe = { class: "u-chat" }, ve = /* @__PURE__ */ I(() => /* @__PURE__ */ e("span", null, "回到底部", -1)), ge = /* @__PURE__ */ I(() => /* @__PURE__ */ e("svg", {
  width: "16",
  height: "16",
  viewBox: "0 0 48 48",
  fill: "none",
  xmlns: "http://www.w3.org/2000/svg"
}, [
  /* @__PURE__ */ e("path", {
    d: "M36 12L24 24L12 12",
    stroke: "#ffffff",
    "stroke-width": "4",
    "stroke-linecap": "round",
    "stroke-linejoin": "round"
  }),
  /* @__PURE__ */ e("path", {
    d: "M36 24L24 36L12 24",
    stroke: "#ffffff",
    "stroke-width": "4",
    "stroke-linecap": "round",
    "stroke-linejoin": "round"
  })
], -1)), we = [
  ve,
  ge
], ke = /* @__PURE__ */ S({
  name: "UChat",
  __name: "chat",
  props: {
    config: {}
  },
  emits: ["load-more", "submit"],
  setup(n, { emit: c }) {
    const a = n, p = w(), l = w(!1), i = M({
      load: 1
    });
    let t = 0;
    function r(s) {
      if (s && s.length == 0) {
        i.load = 2;
        return;
      }
      s.forEach((o) => {
        a.config.user.id == o.uid && (o.float = "right");
      }), a.config.data.unshift(...s.reverse()), j(() => {
        var d;
        const o = document.querySelector(".u-chat .el-scrollbar__wrap");
        o && ((d = p.value) == null || d.setScrollTop(o.scrollHeight - t), t = o.scrollHeight, o.scrollHeight == o.clientHeight && c("load-more", r));
      }), i.load = 1;
    }
    function m(s) {
      s.scrollTop == 0 && (i.load = 0, c("load-more", r)), j(() => {
        const o = document.querySelector(".u-chat .el-scrollbar__wrap");
        if (o) {
          const d = o.scrollTop + o.clientHeight;
          l.value = d < o.scrollHeight - 200;
        }
      });
    }
    function v() {
      const s = document.querySelector(".u-chat .el-scrollbar__wrap");
      s && s.scrollTo({
        top: s.scrollHeight,
        behavior: "smooth"
      });
    }
    return C("injectEmoji", a.config.emoji), C("injectSubmit", (s, o) => {
      c("submit", s, (d) => {
        a.config.user.id == d.uid && (d.float = "right"), a.config.data.push(d), o(), j(() => {
          v();
        });
      });
    }), L(() => {
      c("load-more", r);
    }), (s, o) => (_(), f("div", pe, [
      e("header", null, [
        z(s.$slots, "header", {}, void 0, !0)
      ]),
      e("main", null, [
        h(u(A), {
          ref_key: "scrollbarRef",
          ref: p,
          onScroll: o[0] || (o[0] = (d) => m(d))
        }, {
          default: g(() => [
            h(ae, {
              data: s.config.data,
              load: i.load
            }, null, 8, ["data", "load"])
          ]),
          _: 1
        }, 512),
        e("div", {
          class: b(["skip-bottom", { show: l.value }]),
          onClick: v
        }, we, 2)
      ]),
      e("footer", null, [
        h(he)
      ])
    ]));
  }
});
const ye = /* @__PURE__ */ E(ke, [["__scopeId", "data-v-ff38d4f4"]]), xe = ye;
export {
  xe as U
};
